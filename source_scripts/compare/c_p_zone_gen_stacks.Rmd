
if (zone.gen.stacks & length(db.loc)>1) {

if( !exists('z.gen.scen') ) {
  # Query region and zonal generation
  z.gen.scen = tryCatch( zone_gen_diff(total.generation, total.avail.cap), error = function(cond) { return('ERROR') } )
}

# Check if zonal.gen query worked and create plot of regional gen, else return an error.
if ( typeof(z.gen.scen)=='character' ) {
  print('ERROR: zone_gen_diff function not returning correct results.')
} else if ( typeof(r.load) == 'character' ) {
  print('ERROR: region_load function not returning correct results.')
} else {

  # Call function to create plot and print
  [p1, seq.py] = gen_diff_stack_plot(z.gen.scen[!Zone %in% ignore.zones, ], 
                                     z.load[!Zone %in% ignore.zones, ],
                                     filters = 'Zone')
  print(p1 + facet_wrap(~Zone, scales = 'free', ncol=3))
}
}

} else { print('Section not run according to input file.') }
