
```{r annual_generation_table, include=TRUE}

if ( !exists('yr.gen') ) {
  # Query annual generation by type.
  yr.gen = tryCatch( gen_by_type(), error = function(cond) { return('ERROR: gen_by_type function not returning correct results') } ) 
}
  
if ( typeof(yr.gen)=='character' ) { 
  knitr::kable(yr.gen)
  
} else {
   
  yr.gen$Type = factor(yr.gen$Type, levels = c(gen.order))
  yr.gen = yr.gen[order(yr.gen$Type),]
  row.names(yr.gen) = NULL
  
  gen.tot = data.frame('Type'='Total', 'GWh'=sum(yr.gen$GWh) - yr.gen$GWh[yr.gen$Type=='Curtailment'])
  yr.gen = rbind(yr.gen, gen.tot)
  percent = data.frame('Percent'= yr.gen$GWh / yr.gen$GWh[yr.gen$Type=='Total'] * 100)
  yr.gen = cbind(yr.gen, percent)
  
  kable(yr.gen, format.args = list(big.mark = ','), digits=2)

}
```
