
```{r region_zone_gen_table, include=TRUE}

if ( !exists('r.z.gen') ) {
  # Query region and zonal generation
  r.z.gen = tryCatch( select(region_zone_gen(), Region, Zone, Type, GWh = value), error = function(cond) { return('ERROR') } )
}
  
if ( typeof(r.z.gen)=='character' ) { 
print('ERROR: region_zone_gen function in "zone-gen-stacks" chunk not returning correct results.')
} else {

  r.z.gen.table = r.z.gen %>%
    dcast(Zone+Region~Type, value.var = 'GWh', fun.aggregate = sum) %>%
    filter(Zone != 'BHUTAN')
  
  zone.load = r.z.load %>%
    filter(Type == 'Region') %>%
    select(Region = name, Load = value)
  zone.load$Load = zone.load$Load

  r.z.gen.table = join(r.z.gen.table, zone.load, by = 'Region')
  
  knitr::kable(r.z.gen.table, digits=2, format.args = list(big.mark = ','))

}
```
