
```{r zone-interface-flow-plots, fig.width=9, fig.height = 3, include=TRUE}

if ( exists('interface.flows') ) {
  
if ( typeof(interface.flows)=='character' ) { 
print('ERROR: zone_interface_flows function in "zone-flow-table" chunk not returning correct results.')
} else {

# Define zone names, remove region flows, and order zone names for plotting.
zone.names = c('S1_S2', 'ER_SR', 'NR_ER', 'ER_NER', 'ER_W3', 'NR_WR', 'WR_SR') 
zonal.flows = filter(interface.flows, Type=='Zone') 
zonal.flows$name = factor(zonal.flows$name, levels = c('S1_S2', 'ER_SR', 'NR_ER', 'ER_NER', 'ER_W3', 'NR_WR', 'WR_SR')) 

# Create plot of interval zone interface flow
p1 = ggplot(zonal.flows, aes(x=time, y=-value/1000, color=name, group=name))+
      geom_line(size=1.2)+
      geom_hline(yintercept=0, color="black", size=0.3)+
        scale_x_datetime(breaks = date_breaks(width = "1 month"), labels = date_format("%b"), expand = c(0, 0))+
        scale_color_manual("", values = scen.pal)+
            labs(y="Flow (GW)", x = '', title='Interval Flow')+
            theme(legend.key = element_rect(NULL),
                  legend.text = element_text(size=text.plot),
                  text=element_text(size=text.plot),
                  strip.text=element_text(face="bold", size=rel(1)),
                  axis.text=element_text(face=2, size=text.plot/1),
                  axis.title=element_text(size=text.plot, face=2.3),
                  # legend.position=c(0.80, 0.12),
                  panel.margin = unit(0.35, "lines"))
print(p1)
 
# Aggregate interval flow data into daily flow data
daily.flows = dcast(zonal.flows, time ~ name, value.var = 'value', fun.aggregate=mean)
daily.flows$day = rep(1:(nrow(daily.flows)/24), each=24)
daily.flows = melt(daily.flows, id.vars = 'day', measure.vars = zone.names, variable.name = 'name')

daily.flows = daily.flows %>%
  group_by(day, name) %>%
  summarise(value = sum(value))

# Create daily flow plot.
p2 = ggplot()+
      geom_line(data=daily.flows, aes(x=day, y=-value/1000, color=name, group=name), size=1.2)+
      geom_hline(yintercept=0, , color="black", size=0.3)+
      scale_color_manual("", values = scen.pal)+
      scale_x_continuous(breaks=seq(0, 360, by=30), limits=c(0,370), expand=c(0,0))+
      # scale_x_datetime(breaks = date_breaks(width = "1 month"), labels = date_format("%b %d\n%I %p"), expand = c(0, 0))+
        labs(y="Flow (GW)", x = 'Day', title='Daily Flow')+
            theme(legend.key = element_rect(NULL),
                  legend.text = element_text(size=text.plot),
                  text=element_text(size=text.plot),
                  strip.text=element_text(face="bold", size=rel(1)),
                  axis.text=element_text(face=2, size=text.plot/1),
                  axis.title=element_text(size=text.plot, face=2.3),
                  # legend.position=c(0.80, 0.12),
                  panel.margin = unit(0.35, "lines"))
print(p2)

}
} else { print('Zone interface flow data not found. Make sure "zone-flow-table" chunk is running.')  }
```
